<!DOCTYPE HTML>
<html>
	<head>
		<title>Tong!!</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="file/main.css" /> 
        
    <script>


    var chameleon = 0; //初始化變色龍位置
    var bugs = new Array(); //宣告蟲子陣列

    //確認ｘ，ｙ格子內的蟲子和bugtype是否相同 相同則更改內容並回傳1
    function Checkbug(x,y,bugtype) {
        if ( bugs[x][y]!=31&&Checktype(y,x)==bugtype){//如果不是死掉的蟲子且與按下按鈕的蟲子類型相同   
            document.getElementById(10*y+x).innerHTML='<img src="./file/0.png" alt="" height="100"  >';
            document.getElementById(10*y+x).disabled="disabled";
            bugs[y*5+x]=31;
            return 1;
        }else{
            return 0;
        }
    }

    //確認相同種類的蟲子數量
    function Checkbugnum(x,y) {
        var bugtype = Checktype(y,x);//確認按下按鈕的蟲子類型
        var bugnum = 0; //初始化相同類型蟲子的數量
        
        switch (Checkposition(chameleon)) { //確認變色龍位置
            //在上或下
            case 0:           
            case 2:                     
                if (x==chameleon || chameleon+x==14) {//確認點選的X與變色龍相同位置                    
                    for (let i = 0; i < 5; i++) {//從第1項確認到第五項
                        bugnum = bugnum + Checkbug(x,i,bugtype);                
                    }    
                } else{alert("點選錯誤")} //點選的X與變色龍不在相同位置
                break;

            //在左或右
            default:
                if (y==chameleon-5||chameleon+y==19) {
                    for (let i = 0; i < 5; i++) {
                        bugnum = bugnum + Checkbug(i,y,bugtype);
                    }
                }else{alert("點選錯誤")}
                break;
        }
        return bugnum;
    }

    //按下按鈕時發生    
    function change(y,x){
        chameleon = chameleon + Checkbugnum(x,y); //變色龍根據相同種類蟲子的數量移動
        if (chameleon>19) { //若超過19則循環
            chameleon = chameleon -20;
        }
        Showchame();        
        Checksucc();     
    }

    //確認是否成功
    function  Checksucc() {
        var diebugnum = 0; //初始化新位置的蟲子數量

        switch (Checkposition(chameleon)) {//根據變色龍位置去做不同的動作
            case 0:                            
                for (let i = 0; i < 5; i++) {
                    if (bugs[i*5+chameleon]==31) {
                        diebugnum = diebugnum +1;
                    }
                }                
                break;
           
            case 1:
                for (let i = 0; i < 5; i++) {
                    if (bugs[(chameleon-5)*5+i]==31) {
                        diebugnum = diebugnum +1;
                    }         
                }  
                break;
            
            case 2:
                for (let i = 0; i < 5; i++) {
                    if (bugs[i*5+14-chameleon]==31) {
                        diebugnum = diebugnum +1;
                    }
                    
                } 
                break;

            default:
                for (let i = 0; i < 5; i++) {
                    if (bugs[(19-chameleon)*5+i]==31) {
                        diebugnum = diebugnum +1;
                    }                    
                } 
                break;
        }

        if (diebugnum ==5) { //若有5個則表示遊戲結束
            var all = 0;
            bugs.forEach(element => {
                all = all +element;
            });            
            
            if (all==775) {
                confirm("挑戰成功");
            }else if(confirm("挑戰失敗,是否重新挑戰")){
                window.location.reload();
            }
        }
    }

    //確認變色龍的位置
    function Checkposition(chameleon) {
        switch (chameleon) {
            case 0:
            case 1:
            case 2:
            case 3:
            case 4:
                return 0;　//上方
            
            case 5:
            case 6:
            case 7:
            case 8:
            case 9:
                return 1; //右方

            case 10:
            case 11:
            case 12:
            case 13:
            case 14:
                return 2;  //下方

            default:
                return 3;　//左方
        }        
    }

           
    

    //回傳格子內蟲子的類型  
    function Checktype(y,x) {       
        return Math.floor((bugs[y*5+x]-1)/5);
    }

    //將格子初始化
    function put(){
        Showchame();        
        //建立隨機陣列       
        while (bugs.length<25){
            rand = Math.floor(Math.random()*25)+1;         
            if (bugs.indexOf(rand)==-1){
                bugs[bugs.length]=rand;
            }
        }
        //將隨機陣列放入格子
        Showbugs(bugs);
    }

    //將變色龍放上位置
    function Showchame(){
        //隱藏所有的變色龍格子
        for (let i = 0; i < 20; i++) {
            var chame = document.getElementById('a'+i);            
            chame.innerHTML = '<img src="./file/chameleon.png" alt="" height="100" style="VISIBILITY: hidden">';
        }
        //將變色龍圖片放入變色龍的位置       
       document.getElementById('a'+chameleon).innerHTML = '<img src="./file/chameleon.png" alt="" height="100" >';
    }

    //將所有的蟲子放上位置
    function Showbugs(bugs){
        for (let i = 0; i < 5; i++) {
            for (let j = 0; j < 5; j++) {   
                document.getElementById(i*10+j).innerHTML = '<img src="./file/'+bugs[i*5+j]+'.png" alt="" height="100" />'  
            }            
        } 
    }
    
    
    </script>


    </head>
    
    
    
	<body onLoad="put()">

        <div id="BOX">
            <div id="Header">
                <img src="./file/title.png"  width="450px"> 
                <br></br> 
                <img src="./file/sidebox.png"  width="450px"> 
                
                <br></br> 
                <h3><a href="https://boardgamegeek.com/boardgame/186141/tong" target="blank">https://boardgamegeek.com/boardgame/186141/tong</a></h3> 
                                 
            </div>  
                      
        </div>
        <div id="Rulers">
                <img src="./file/Target.png"  width="400px">
                <br></br>  
                <img src="./file/Rules.png"  width="350px">
                
           
        </div>
        <div id="Body">
                
			<form  action="#">
               

                <div id="topbtm">									
                    <button id="a0" ></button><button id="a1"></button><button id="a2" ></button><button id="a3" ></button><button id="a4" >                
                </div>

				<div >									
                    <button id="a19" ></button><button id="0" onclick="change(0,0)">  蚊子  </button><button id="1" onclick="change(0,1)"> 蒼蠅 </button><button id="2" onclick="change(0,2)"> 蝴蝶 </button><button id="3" onclick="change(0,3)"> 蒼蠅 </button><button id="4" onclick="change(0,4)"> 毛毛蟲 </button><button id="a5" ></button>                              
                </div>

                <div >									
                    <button id="a18" ></button><button id="10" onclick="change(1,0)"> 蚊子 </button><button id="11" onclick="change(1,1)">蜘蛛</button><button id="12" onclick="change(1,2)"> 蝴蝶 </button><button id="13" onclick="change(1,3)"> 毛毛蟲 </button><button id="14" onclick="change(1,4)">蜘蛛</button><button id="a6" ></button>                               
                </div>

                <div >									
                    <button id="a17" ></button><button id="20" onclick="change(2,0)"> 蒼蠅 </button><button id="21" onclick="change(2,1)"> 蚊子 </button><button id="22" onclick="change(2,2)"> 毛毛蟲 </button><button id="23" onclick="change(2,3)"> 蚊子 </button><button id="24" onclick="change(2,4)"> 蝴蝶 </button><button id="a7" ></button>                                
                </div>

                <div >									
                    <button id="a16" ></button><button id="30" onclick="change(3,0)">蜘蛛</button><button id="31" onclick="change(3,1)"> 蒼蠅 </button><button id="32" onclick="change(3,2)"> 蚊子 </button><button id="33" onclick="change(3,3)">蜘蛛</button><button id="34" onclick="change(3,4)"> 毛毛蟲 </button><button id="a8" ></button>                             
                </div >

                <div >	
                    <button id="a15" ></button><button id="40" onclick="change(4,0)"> 蝴蝶 </button><button id="41" onclick="change(4,1)">蜘蛛</button><button id="42" onclick="change(4,2)"> 蒼蠅 </button><button id="43" onclick="change(4,3)"> 毛毛蟲 </button><button id="44" onclick="change(4,4)"> 蝴蝶 </button><button id="a9" ></button> 
                </div>
                
                <div id="topbtm">
                    </button><button id="a14" ></button><button id="a13" ></button><button id="a12" ></button><button id="a11" ></button><button id="a10" ></button>  
                </div>
                <img src="./file/toptitle.png"  width="500px">
            </form>
        </div>
        
        <div style="clear:both;"></div>

	</body>
</html>